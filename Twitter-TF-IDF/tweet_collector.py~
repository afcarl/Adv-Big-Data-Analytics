# -*- coding: utf-8 -*-
"""
Created on Thu Feb 11 23:43:52 2016

@author: rohan
"""
from tweepy.streaming import StreamListener
from tweepy import OAuthHandler
from tweepy import Stream
import json

access_token = "54642043-QsXx3bSjhqnmq4H0WPfvfcrmrq5hXBCCIznXgF5Bx"
access_token_secret = "P4ZJPwb0F1JW8DKJYfgNwixwleaJU1HmRTD9tKMEjwQJF"
consumer_key = "9oVh7BXbJsCYpyC98hN1vCr5j"
consumer_secret = "RaRCXEhMQPjhhMGhwdOZDXQhFPb3eXQDg5YT9gUuuZk8RgUOq0"


#This is a basic listener that just prints received tweets to stdout.
class StdOutListener(StreamListener):
    def __init__(self,companies):
        self.companies = companies
        
    def on_data(self, data):
        companies = self.companies
        data = json.loads(data)
        print "collecting data.."
        try:
            if companies[0].lower() in data['text'].lower():
                with open(companies[0]+"_tweets.txt", "a") as myfile:
                    myfile.write(data['text'])
            
            elif companies[1].lower() in data['text'].lower():
                with open(companies[1]+"_tweets.txt", "a") as myfile:
                    myfile.write(data['text'])
            
            elif companies[2].lower() in data['text'].lower():
                with open(companies[2]+"_tweets.txt", "a") as myfile:
                    myfile.write(data['text'])
            
            elif companies[3].lower() in data['text'].lower():
                with open(companies[3]+"_tweets.txt", "a") as myfile:
                    myfile.write(data['text'])
            
            elif companies[4].lower() in data['text'].lower():
                with open(companies[4]+"_tweets.txt", "a") as myfile:
                    myfile.write(data['text'])
        except Exception as e:
            print e
        
        return True

    def on_error(self, status):
        print status


if __name__ == '__main__':

    #This handles Twitter authetification and the connection to Twitter Streaming API
    companies = ['Twitter','Apple','Microsoft','Facebook','Google']    
    l = StdOutListener(companies)
    auth = OAuthHandler(consumer_key, consumer_secret)
    auth.set_access_token(access_token, access_token_secret)
    stream = Stream(auth, l)

    #This line filter Twitter Streams to capture data by the keywords: 'python', 'javascript', 'ruby'            
    stream.filter(track=companies)
